<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Welcome to the /usr/sbin/ece-install Guide</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="Welcome to the /usr/sbin/ece-install Guide"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-02-07 19:40:37 CST"/>
<meta name="author" content="Torstein Krause Johansen"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><style type="text/css">
body {
  font-family: Arial, Helvetica, sans-serif;
  font-size: small;
  #width : 600;
  margin: 70px 70px 0px 50px;
}

pre {
  background-color: grey;
}

h1, h2 {
  color: #e88424;
}

h1 {
  font-size: 150%;
}

h2 {
  font-size: 120%;
  margin-top: 3em;
  margin-bottom: 0em;
}

h3, h4, h5, h6 {
  font-weight: bold;
  margin-top: 2em;
  margin-bottom: 0.2em;
}

h3, h4, h5 {
  font-size: 110%;
}

h6 {
  font-size: 80%;
}

a {
  color: #333;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

p, dl {
  font-size: 95%;
}

p {
  margin-top: 0em;
  margin-bottom: 0.6em;
}

pre.programlisting {
  margin-top: 0em;
  background-color: #ffddaa;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-left: 0.5em;
  padding-right: 0.5em;
}

em {
  font-weight: bold;
  font-style: normal;
}

em.replaceable {
  font-weight: normal;
  font-style: italic;
}

div.note {
  background-color: #ffddaa;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-left: 0.5em;
  padding-right: 0.5em;
}
</style>

<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">
<svg
        id="vizrt-logo"
        version="1.1"
        width="138"
        height="84"
        > 
  <g
          id="g12"
          transform="matrix(1.25,0,0,-1.25,-451.34003,425.24315)"> 
    <g
            id="g14"
            transform="matrix(0.0246257,0,0,0.02458666,313.76213,231.21317)"> 
      <path
              d="m 3060.56,3437.2 -209.9,-593.4 -207.05,593.4 -215.82,0 326.08,-866.38 184.92,0 332.24,866.38 -210.47,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path16"/> 
      <path
              d="m 3473.3,2569.82 193.547,0 0,866.531 -193.547,0 0,-866.531 z"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path18"/> 
      <path
              d="m 3916.16,3436.36 -0.14,-177.24 364.23,0 -372.91,-554.74 0,-133.56 616.08,0 0,175.25 -374.66,0 366.68,550.78 0,139.51 -599.28,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path20"/> 
      <path
              d="m 4961.8,3436.66 c -56.15,0 -99.9,-9.02 -144.01,-53.04 -42.13,-42.13 -63.55,-93.63 -63.55,-153.7 l 0,-658.85 193.26,0 0,629.18 c 0,16.39 5.76,30.04 17.53,41.82 9.79,9.87 32.16,17.44 52.18,17.44 l 161.49,0 0,177.15 -216.9,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path22"/> 
      <path
              d="m 5367.91,3699.54 0,-915.91 c 0,-58.68 20.75,-109.43 62.13,-150.8 43.31,-43.47 85.57,-62.01 141.03,-62.01 l 212.69,0 0,174.7 -158.78,0 c -15.96,0 -28.96,5.5 -40.72,16.87 -11.19,11.53 -16.76,24.5 -16.76,40.65 l 0,456.42 216.26,0 0,176.39 -216.26,0 0,263.69 -199.59,0"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path24"/> 
      <path
              d="m 1921.16,3066.86 c -0.39,-514.15 173.24,-988.49 465.56,-1367.51 l 69.26,204.63 c -205.49,300.61 -333.44,658.06 -355.3,1043.68 l -179.52,119.2"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path26"/> 
      <path
              d="m 6404.28,3065.28 c 0.49,513.97 -173.17,988.55 -465.37,1367.26 l -69.46,-204.34 c 205.52,-300.7 333.61,-658.34 355.24,-1043.68 l 179.59,-119.24"
              style="fill:#f57615;fill-opacity:1;fill-rule:evenodd;stroke:none"
              id="path28"/> 
 
    </g> 
  </g> 
</svg>

</div>

<div id="content">
<h1 class="title">Welcome to the /usr/sbin/ece-install Guide</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Supported Operating Systems</a>
<ul>
<li>
<ul>
<li><a href="#sec-1-1">1.1 Debian based operating systems</a></li>
<li><a href="#sec-1-2">1.2 Other GNU/Linux and Unix systems</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-2">2 A Note on Running ece-install On Non-GNU/Linux Systems</a></li>
<li><a href="#sec-3">3 Downloading the ece-install Script</a></li>
<li><a href="#sec-4">4 Running the ece-install Script</a></li>
<li><a href="#sec-5">5 Available Server Profiles</a>
<ul>
<li><a href="#sec-5-1">5.1 Common for All Server Profiles</a></li>
<li><a href="#sec-5-2">5.2 Common for Editorial, Presentation and Search Instances</a>
<ul>
<li><a href="#sec-5-2-1">5.2.1 Sun Java 6</a></li>
<li><a href="#sec-5-2-2">5.2.2 Apache Tomcat application server</a></li>
<li><a href="#sec-5-2-3">5.2.3 Basic Escenic Nursery configuration</a></li>
<li><a href="#sec-5-2-4">5.2.4 APR, native library for optimal Tomcat I/O performance</a></li>
<li><a href="#sec-5-2-5">5.2.5 Escenic Assembly environment</a></li>
<li><a href="#sec-5-2-6">5.2.6 Database driver</a></li>
<li><a href="#sec-5-2-7">5.2.7 Compression of content</a></li>
</ul>
</li>
<li><a href="#sec-5-3">5.3 Profile - Full Stack on One Host</a></li>
<li><a href="#sec-5-4">5.4 Profile - Editorial Server (Publication Server)</a></li>
<li><a href="#sec-5-5">5.5 Profile - Presentation Server</a></li>
<li><a href="#sec-5-6">5.6 Profile - Database Server</a></li>
<li><a href="#sec-5-7">5.7 Profile - Cache Server</a></li>
<li><a href="#sec-5-8">5.8 Profile - Install Widget Framework</a></li>
<li><a href="#sec-5-9">5.9 Profile - Create Publication</a></li>
<li><a href="#sec-5-10">5.10 Profile - Monitoring Server</a></li>
<li><a href="#sec-5-11">5.11 Profile - Restoring from backup</a></li>
<li><a href="#sec-5-12">5.12 Running interactively</a>
<ul>
<li><a href="#sec-5-12-1">5.12.1 Start ece-install and choose the Option, "Restore from backup"</a></li>
<li><a href="#sec-5-12-2">5.12.2 Select Which Backup to Restore</a></li>
<li><a href="#sec-5-12-3">5.12.3 Choose What to Restore</a></li>
<li><a href="#sec-5-12-4">5.12.4 Sit Back and Watch ece-install Restore the Data for You</a></li>
</ul>
</li>
<li><a href="#sec-5-13">5.13 Running in FAI mode</a></li>
<li><a href="#sec-5-14">5.14 Data security</a></li>
</ul>
</li>
<li><a href="#sec-6">6 Full Automatic Install (FAI)</a>
<ul>
<li><a href="#sec-6-1">6.1 Installing from EARs instead of Binaries</a></li>
<li><a href="#sec-6-2">6.2 Setting up virtual hosts</a></li>
<li><a href="#sec-6-3">6.3 Overview of All FAI Parameters</a></li>
<li><a href="#sec-6-4">6.4 Examples</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1 Installing an Editorial Server &amp; Create a Publication</a></li>
<li><a href="#sec-6-4-2">6.4.2 Installing Two Presentation Servers On a Single Host</a></li>
</ul>
</li>
<li><a href="#sec-6-5">6.5 Verifying That the Script Is Running In FAI Mode</a></li>
</ul>
</li>
<li><a href="#sec-7">7 Running More Than One Installation Process</a></li>
<li><a href="#sec-8">8 Re-running ece-install (and How To Speed It Up)</a></li>
<li><a href="#sec-9">9 Using a Custom Configuration File for ece-install</a></li>
<li><a href="#sec-10">10 Overview of File Paths Used by the ece-install script</a></li>
<li><a href="#sec-11">11 Overriding the Escenic directories</a></li>
<li><a href="#sec-12">12 Extending ece-install by Writing Hooks</a>
<ul>
<li><a href="#sec-12-1">12.1 Accessing ece-install variables</a></li>
<li><a href="#sec-12-2">12.2 Example hook</a></li>
<li><a href="#sec-12-3">12.3 Available hooks</a></li>
</ul>
</li>
<li><a href="#sec-13">13 Assumptions</a>
<ul>
<li><a href="#sec-13-1">13.1 /etc/esecenic is shared</a></li>
</ul>
</li>
<li><a href="#sec-14">14 Uninstalling Everything That the ece-install Set Up</a></li>
<li><a href="#sec-15">15 Example Output FAI</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Supported Operating Systems</h2>
<div class="outline-text-2" id="text-1">

<p>For the best experience, run this script on Debian Squeeze (or newer),
the latest Ubuntu LTS or most other Debian based operating systems,
but it should work without any problems on any Unix like system that
has a recent version of BASH.
</p>

</div>

<div id="outline-container-1-1" class="outline-4">
<h4 id="sec-1-1"><span class="section-number-4">1.1</span> Debian based operating systems</h4>
<div class="outline-text-4" id="text-1-1">

<p>If running on a Debian based operating system, ece-install will take
care of installing all required third party software, such as database
&amp; caching server.
</p>
</div>

</div>

<div id="outline-container-1-2" class="outline-4">
<h4 id="sec-1-2"><span class="section-number-4">1.2</span> Other GNU/Linux and Unix systems</h4>
<div class="outline-text-4" id="text-1-2">

<p>If you're installing on another Linux or Unix system, you must first
make sure that these 3rd party components are installed. ece-install
will tell you which ones it cannot find and tell you to install these,
so you can simply run it to find out which ones you need.
</p>
<p>
You may also look inside the ece-install script for all calls to the
'assert_pre_prequesite' method and you'll get a list of the binaries
ece-install assumes are present.
</p>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> A Note on Running ece-install On Non-GNU/Linux Systems</h2>
<div class="outline-text-2" id="text-2">

<p>Please note, it's assumed that the OS uses GNU's tools, i.e. find, cp
&amp; tar. If you're running a system which has a different set of core
tools, such as any of the BSDs (including Mac OS X) or Solaris, make
sure that GNU's tools take precedence in the command PATH offered to
ece-install.
</p>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Downloading the ece-install Script</h2>
<div class="outline-text-2" id="text-3">

<p>The ece-install script can be downloaded from:
<a href="https://raw.github.com/skybert/ece-scripts/master/usr/sbin/ece-install">https://raw.github.com/skybert/ece-scripts/master/usr/sbin/ece-install</a>
or be downloaded together with the other ece-scripts using git:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">$ git clone git@github.com</span>:skybert/ece-scripts.git
</pre>


</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Running the ece-install Script</h2>
<div class="outline-text-2" id="text-4">

<p>You must run the script as the root user.  If you start the script as
a regular user, it will complain:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] You must be root when running ece-install
</pre>

<p>
To become root on Ubuntu based systems and Mac OS X, do:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">$</span> sudo su
</pre>

<p>
Please note that just doing "sudo ece-install" may not work.
</p>
<p>
On all other Unix like system, do:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">$</span> su -
</pre>


<p>
You will need access to <a href="http://technet.escenic.com">http://technet.escenic.com</a> and put these
credentials in the root user's $HOME/ece-install.conf, normally this
means /root/ece-install.conf, the script will also tell you this if
you forget to provide such a configuration file:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] /root/ece-install.conf doesn<span style="color: #ffa07a;">'t exist, I cannot live without it :-(</span>
</pre>


<p>
As for the technet credentials, the script will also tell you if it
cannot find what it's looking for:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] Be sure to set technet_user and technet_password
[<span style="color: #98fb98;">ece-install</span>] in /root/ece-install.conf
</pre>


<p>
The minimum ece-install.conf file is thus:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">technet_user</span>=&lt;user&gt;
<span style="color: #f0dfaf;">technet_password</span>=&lt;password&gt;
</pre>


<p>
If you're installing WF as well, you'll need additional credentials
for this, see the Widget Framwork section below, and if you want to
runn a fully automatic install without any user interaction, you'll
need to specify some FAI specific parameters, see the FAI section
below. 
</p>
<p>
With the configuration file in place, you're now ready to run it:
</p>


<pre class="src src-conf"><span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">bash ece-install [-v|--verbose]</span>
</pre>


<p>
ece-install will try to "fail fast", exiting as soon as it detects an
error during its execution:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install-1] The command [cd /does/not/exist</span>] FAILED, exiting :-(
[<span style="color: #98fb98;">ece-install-1</span>] See /var/log/ece-install.log for further details.
</pre>


<p>
As a last resort, if something goes astray with the script, and the
log file cannot give you enough clues, the ultimate way of debugging
this is to run the BASH interpreter with the -x flag:
</p>


<pre class="src src-conf"><span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">bash -x ece-install</span>
</pre>


<p>
Here you can see everything that BASH does when running the script,
how the wildcard variables expand and so on. Normally, having a tail
on /var/log/ece-install.log should be sufficient, though.
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Available Server Profiles</h2>
<div class="outline-text-2" id="text-5">

<p>When starting the script, it will ask you which server profile you
want to install:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">Hi,</span> which server profile do you wish to install?

   <span style="color: #f0dfaf;">1</span> - All in one, full stack on one host, suitable for dev &amp; test environments
   <span style="color: #f0dfaf;">2</span> - Editorial (publication) server
   <span style="color: #f0dfaf;">3</span> - Presentation server (ECE + memcached).
   <span style="color: #f0dfaf;">4</span> - Database server
   <span style="color: #f0dfaf;">5</span> - Cache server (cache and web server)
   <span style="color: #f0dfaf;">6</span> - RMI hub
   <span style="color: #f0dfaf;">7</span> - Search server (Solr + indexer-webapp)
   <span style="color: #f0dfaf;">8</span> - Install Widget Framework.
   <span style="color: #f0dfaf;">9</span> - Create a new publication based on WF if available, ECE/clean-demo if not
   <span style="color: #f0dfaf;">10</span> - A monitoring server (web server + Munin gatherer)
   <span style="color: #f0dfaf;">11</span> - Restore from backup (DB, data files, binaries, conf &amp; publications)

<span style="color: #f0dfaf;">Select</span> 1-11 and press ENTER
<span style="color: #f0dfaf;">Your</span> choice [1]&gt; 
</pre>


</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Common for All Server Profiles</h3>
<div class="outline-text-3" id="text-5-1">

<p>The script will install a Munin node on the host. It will also
install the Escenic specific Munin plugins on hosts where there are
any Escenic server components.
</p>
</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Common for Editorial, Presentation and Search Instances</h3>
<div class="outline-text-3" id="text-5-2">


</div>

<div id="outline-container-5-2-1" class="outline-4">
<h4 id="sec-5-2-1"><span class="section-number-4">5.2.1</span> Sun Java 6</h4>
<div class="outline-text-4" id="text-5-2-1">

</div>

</div>

<div id="outline-container-5-2-2" class="outline-4">
<h4 id="sec-5-2-2"><span class="section-number-4">5.2.2</span> Apache Tomcat application server</h4>
<div class="outline-text-4" id="text-5-2-2">

<ul>
<li>Compression of textual content (previously, this was typically set
  up with Apache and its mod_deflate module).
</li>
<li>pooling set up tweaked for high read/write performance.
</li>
<li>proper logging configuration directing solr messages to its own log.
</li>
<li>routing information in the cookies
</li>
<li>application server access log
</li>
</ul>

</div>

</div>

<div id="outline-container-5-2-3" class="outline-4">
<h4 id="sec-5-2-3"><span class="section-number-4">5.2.3</span> Basic Escenic Nursery configuration</h4>
<div class="outline-text-4" id="text-5-2-3">

<p>The basic Nursery configuration is taken care of for you, including RMI,
  database, search and application server/URIs. 
</p></div>

</div>

<div id="outline-container-5-2-4" class="outline-4">
<h4 id="sec-5-2-4"><span class="section-number-4">5.2.4</span> APR, native library for optimal Tomcat I/O performance</h4>
<div class="outline-text-4" id="text-5-2-4">

</div>

</div>

<div id="outline-container-5-2-5" class="outline-4">
<h4 id="sec-5-2-5"><span class="section-number-4">5.2.5</span> Escenic Assembly environment</h4>
<div class="outline-text-4" id="text-5-2-5">

<p>The reason why ece-install sets this up on each host, is to make the
installation process as smooth as possible. The assembly environment
may be removed after the installation if you want to.
</p>
</div>

</div>

<div id="outline-container-5-2-6" class="outline-4">
<h4 id="sec-5-2-6"><span class="section-number-4">5.2.6</span> Database driver</h4>
<div class="outline-text-4" id="text-5-2-6">


</div>

</div>

<div id="outline-container-5-2-7" class="outline-4">
<h4 id="sec-5-2-7"><span class="section-number-4">5.2.7</span> Compression of content</h4>
<div class="outline-text-4" id="text-5-2-7">

<p>This was was previously accomplished by having a web server in fron t
of the application server (or cache server if you used ESI). A typical
system architecture would contain Apache with mod_deflate. However,
this is no longer necessary as Varnish can handles ESI parsing of
compressed content (and many other things that we before needed Apache
for). Thus, we'll let the application server do the compression for us
now.
</p>
</div>
</div>

</div>

<div id="outline-container-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Profile - Full Stack on One Host</h3>
<div class="outline-text-3" id="text-5-3">

<p>This profile is suitable for developers and admins wanting to set up a
test environment. It will install the full stack including caching
server, application server, ECE, assembly host, database, Widget
Framework, as well as creating a publication for you.
</p>
<p>
For further details on each of the different server components, see
the different profile descriptions bellow.
</p>

</div>

</div>

<div id="outline-container-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Profile - Editorial Server (Publication Server)</h3>
<div class="outline-text-3" id="text-5-4">

<p>Will set up a typical editorial server (often referred to as the
publication server in Escenic literature).
</p>
</div>

</div>

<div id="outline-container-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Profile - Presentation Server</h3>
<div class="outline-text-3" id="text-5-5">

<p>This will set up a typical presentation server:
</p><ul>
<li>Memcached, distributed memory cache
</li>
<li>Deployment setup to only deploy escenic-admin and the
  publication(s).
</li>
</ul>


</div>

</div>

<div id="outline-container-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Profile - Database Server</h3>
<div class="outline-text-3" id="text-5-6">

<p>If ece-install is run on a support version of Debian or Ubuntu, this
will install the excellent Percona distribution of MySQL with their
set of high performance patches.
</p>
<p>
If not, MySQL or Percona must be installed in advance.
</p>
<p>
Given that the mysqld is install, this profile will download all the
Escenic components and install the ECE database schema based from the
SQL files contained inside the distribution bundles. To accomplish
this, the script will make a call to drop-and-create-ecedb in the same
directory as the ece-intall script itself.
</p>
<p>
The script will fail by itself if the DB already exists:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] Setting up the ECE database schema ...
<span style="color: #f0dfaf;">ERROR 1007 (HY000) at line 1</span>: Can<span style="color: #ffa07a;">'t create database '</span>ece5db<span style="color: #ffa07a;">'; database exists</span>
<span style="color: #ffa07a;">ERROR 1050 (42S01) at line 2: Table '</span>DBChangeLog<span style="color: #ffa07a;">' already exists</span>
<span style="color: #ffa07a;">[ece-install] running tables FAILED, exiting :-(</span>
</pre>


</div>

</div>

<div id="outline-container-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> Profile - Cache Server</h3>
<div class="outline-text-3" id="text-5-7">

<p>If ece-install is run on a support version of Debian or Ubuntu, it
will install the latest Varnish 3.0 caching server from the Varnish
APT repository.
</p>
<p>
If ece-install is run on a different platform, the admin must install
Varnish 3.x prior to running ece-install.
</p>
<p>
The script will configure Varnish for a typical Escenic site:
</p><ul>
<li>it will set up the cache server on port 80
</li>
<li>will set up an access control lists of IPs which may access the
  privileged web applications such as /escenic-admin, /escenic and
  /webservice.

<p>
  ece-install will also add the host from which you connect, making
  sure that if you've SSH-ed into the server to conduct the install,
  you'll automatically be included in the "staff" ACL and can access
  all the web applications without editing these ACLs (or disabling
  security as many does).
</p>
</li>
<li>will set up sticky sessions/session binding
</li>
<li>will set up a backend cluster and allow the user to enter the
  different backend servers that will serve the web site.
</li>
<li>will set up configuration to strip away cookies from static
  resources, such as CSS, JS and pictures.
</li>
<li>will install the nginx web server for serving static content and
  will configure Varnish accordingly. This will be very useful for
  Adactus servers wanting to pull content from your ECEs.
</li>
</ul>


<p>
TBD:
</p><ul>
<li>If run on a Linux platform, the script will tweak the kernel
  parameters for optimal TCP handling for a web facing server.
</li>
<li>let the /munin run through on port 80, requiring the connecting IPs
  to be in the staff network ACL, defined in the Varnish
  configuration. 
</li>
</ul>


</div>

</div>

<div id="outline-container-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> Profile - Install Widget Framework</h3>
<div class="outline-text-3" id="text-5-8">

<p>You'll need a user name and password for accessing the
repo.escenic.com Maven repository. You should get these credentials
when you bought Widget Framework. If you for some reason do not have
these, please contact support@escenic.com. 
</p>
<p>
If you don't have these ready in your ece-install.conf, ece-install will
complain:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] Be sure to set wf_user and wf_password in /root/ece-install.conf
[<span style="color: #98fb98;">ece-install</span>] If you don<span style="color: #ffa07a;">'t have these, please contact support@escenic.com</span>
</pre>

</div>

</div>

<div id="outline-container-5-9" class="outline-3">
<h3 id="sec-5-9"><span class="section-number-3">5.9</span> Profile - Create Publication</h3>
<div class="outline-text-3" id="text-5-9">

<p>This profile will create a publication for you, only asking you the
name of the publication and which ECE instance to use for its
creation.
</p>
<p>
This installation profile will base the publication on the Widget
Framework if its present on the system, if not, ECE's clean demo WAR
is used as a basis.  
</p></div>

</div>

<div id="outline-container-5-10" class="outline-3">
<h3 id="sec-5-10"><span class="section-number-3">5.10</span> Profile - Monitoring Server</h3>
<div class="outline-text-3" id="text-5-10">

<p>This will install a Munin gatherer and web server. The latter for
accessing the reports generated by the former.
</p>
<p>
TBD: This profile will also install the Nagios interface for
monitoring the different nodes. 
</p>
</div>

</div>

<div id="outline-container-5-11" class="outline-3">
<h3 id="sec-5-11"><span class="section-number-3">5.11</span> Profile - Restoring from backup</h3>
<div class="outline-text-3" id="text-5-11">

<p>ece-install can restore from a backup made by the ece script:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">$</span> ece -i &lt;instance&gt; backup
</pre>


<p>
As stated in the ece guide, this backup may contain (depending on
what's available on the host where it's run):
</p><ul>
<li>database dump of the instance
</li>
<li>data files (pictures, video files and so on). This is often referred
  to as the "multimedia archive" in Escenic literature.
</li>
<li>ECE, cache and web server configuration
</li>
<li>Escenic software
</li>
</ul>


</div>

</div>

<div id="outline-container-5-12" class="outline-3">
<h3 id="sec-5-12"><span class="section-number-3">5.12</span> Running interactively</h3>
<div class="outline-text-3" id="text-5-12">


</div>

<div id="outline-container-5-12-1" class="outline-4">
<h4 id="sec-5-12-1"><span class="section-number-4">5.12.1</span> Start ece-install and choose the Option, "Restore from backup"</h4>
<div class="outline-text-4" id="text-5-12-1">




<pre class="src src-text"># ece-install
</pre>


</div>

</div>

<div id="outline-container-5-12-2" class="outline-4">
<h4 id="sec-5-12-2"><span class="section-number-4">5.12.2</span> Select Which Backup to Restore</h4>
<div class="outline-text-4" id="text-5-12-2">





<pre class="src src-text">[ece-install-5] From which dataset do you wish to backup?
    1 - engine-dev1-backup-2011-10-10.tar.gz
    2 - engine-dev1-backup-2011-10-11.tar.gz
[ece-install-5] Enter the number next to the tarball, from 1 to 2
Your choice [1]&gt;
</pre>


<p>
The ece script mentioned above will create backups in
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">/var/backups/escenic</span>
</pre>

<p>
and the ece-install script will hence expect to find them here.
</p>
</div>

</div>

<div id="outline-container-5-12-3" class="outline-4">
<h4 id="sec-5-12-3"><span class="section-number-4">5.12.3</span> Choose What to Restore</h4>
<div class="outline-text-4" id="text-5-12-3">




<pre class="src src-text">[ece-install-12] Which part of the system do you wish to restore?
    1 - The database
    2 - The Solr and ECE data files (multimedia archive)
    3 - The ECE configuration files
    4 - The Escenic and Tomcat software binaries + publication templates
Your choice [1]&gt; 2
</pre>


</div>

</div>

<div id="outline-container-5-12-4" class="outline-4">
<h4 id="sec-5-12-4"><span class="section-number-4">5.12.4</span> Sit Back and Watch ece-install Restore the Data for You</h4>
<div class="outline-text-4" id="text-5-12-4">




<pre class="src src-text">[ece-install-13] Restoring the Solr &amp; ECE data files on ubiquitous ...
[ece-install-21] - The installation is now complete! It took 0d 0h 0m 20s
[ece-install] Successfully restored Solr &amp; ECE data files
[ece-install] from backup:  engine-dev1-backup-2011-10-12.tar.gz
[ece-install] Check /var/lib/escenic to verify they're all there
</pre>


</div>
</div>

</div>

<div id="outline-container-5-13" class="outline-3">
<h3 id="sec-5-13"><span class="section-number-3">5.13</span> Running in FAI mode</h3>
<div class="outline-text-3" id="text-5-13">

<p>If you're running in FAI mode, you can choose between these settings
to decide what to restore and where to find the backup file to
restore from:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col class="left" /><col class="right" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Parameter</th><th scope="col" class="right">Default</th><th scope="col" class="left">Description</th></tr>
</thead>
<tbody>
<tr><td class="left">fai_restore_all</td><td class="right">0</td><td class="left">Restore everything found in the backup file</td></tr>
<tr><td class="left">fai_restore_db</td><td class="right">0</td><td class="left">Install the DB server &amp; restore its contents</td></tr>
<tr><td class="left">fai_restore_data_files</td><td class="right">0</td><td class="left">Restore the Solr &amp; ECE data files</td></tr>
<tr><td class="left">fai_restore_configuration</td><td class="right">0</td><td class="left">Restore the Solr &amp; ECE configuration files</td></tr>
<tr><td class="left">fai_restore_software_binaries</td><td class="right">0</td><td class="left">Restore the Escenic and Apache Tomcat software</td></tr>
<tr><td class="left">fai_restore_from_file</td><td class="right">""</td><td class="left">The .tar.gz produced by "ece -i &lt;instance&gt; backup"</td></tr>
</tbody>
</table>


<p>
For example, to restore everything possible from a given tarball, you
need this in your ece-install.conf:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">fai_enabled</span>=1

<span style="color: #f0dfaf;">fai_restore_from_backup</span>=1
<span style="color: #f0dfaf;">fai_restore_all</span>=1
<span style="color: #f0dfaf;">fai_restore_from_file</span>=/var/backups/escenic/engine-dev1-backup-2011-10-10.tar.gz
</pre>


</div>

</div>

<div id="outline-container-5-14" class="outline-3">
<h3 id="sec-5-14"><span class="section-number-3">5.14</span> Data security</h3>
<div class="outline-text-3" id="text-5-14">

<p>You should take heed when running restore, so that you're not
restoring a system which you didn't want to change (yes, this mishap
does happen).
</p>
<p>
The ece-install script will help you a bit on the way, but the final
responsibility always lies with you as the user. 
</p>
<p>
If you're trying to restore the DB and the ECE schema already exists,
the restore will fail:
</p>


<pre class="src src-text">[ece-install-8] Restoring the database contents on ubiquitous ...
[ece-install-24] Selecting the most recent database dump ece5db-2011-10-10.sql.gz
ERROR 1007 (HY000) at line 1: Can't create database 'ece5db'; database exists
ERROR 1050 (42S01) at line 25: Table '`ece5db`.`AccessControlList`' already exists
[ece-install-24] The command [restoring from var/backups/escenic/ece5db-2011-10-10.sql.gz] FAILED, exiting :-(
[ece-install-24] See /var/log/ece-install.log for further details.
</pre>

</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Full Automatic Install (FAI)</h2>
<div class="outline-text-2" id="text-6">

<p>The ece-install script has support for doing a full automatic install
(FAI). You can only install one profile at a time. The profiles are
the parameters with "install" in their name, such as:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">fai_editor_install</span>
</pre>


<p>
When running in FAI mode, you probably want to redirect standard
output to a log file for easy reading later on:
</p>


<pre class="src src-conf"><span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">bash ece-install &gt; ece-install.out &amp;</span>
</pre>


<p>
Alternatively, you may do:
</p>


<pre class="src src-conf"><span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">nohup bash ece-install &gt; ece-install.out &amp;</span>
</pre>

<p>
The "nohup" at the beginning and the ampersand at the end lets you log
out of the SSH/X session to your Linux/Unix box while the script keeps
running in the background.
</p>

</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Installing from EARs instead of Binaries</h3>
<div class="outline-text-3" id="text-6-1">

<p>It is possible to get ece-install to use a supplied EAR and
configuration archive instead of using the files provided with the
Escenic Content Engine &amp; plugins.
</p>
<p>
The EAR to provide is the one you generate with:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">$</span> ece -i &lt;instance&gt; assemble 
</pre>

<p>
Normally, the EAR will then be available in:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">/var/cache/escenic/engine.ear</span>
</pre>


<p>
The configuration bundle must contain:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">engine/security</span>
<span style="color: #f0dfaf;">engine/siteconfig/bootstrap-skeleton</span>
<span style="color: #f0dfaf;">engine/siteconfig/config-skeleton</span>
<span style="color: #f0dfaf;">assemblytool/plugins/&lt;plugin&gt;/siteconfig</span>
</pre>


<p>
and optionally also:
</p>


<pre class="src src-sh">engine/solr/conf
</pre>


<p>
A simple way to create this bundle, is to use a server which has the
assembly environment set up and then do:
</p>



<pre class="src src-conf"><span style="color: #f0dfaf;">$</span> cd /opt/escenic
<span style="color: #f0dfaf;">$</span> tar czf /tmp/nursery-skeleton-solr-and-security.tar.gz \
  <span style="color: #f0dfaf;">engine/security</span> \
  <span style="color: #f0dfaf;">engine/siteconfig/config-skeleton/</span> \
  <span style="color: #f0dfaf;">engine/solr/conf</span> \
  <span style="color: #f0dfaf;">engine/siteconfig/bootstrap-skeleton/</span> \
  <span style="color: #f0dfaf;">`find</span> -L assemblytool/plugins/ -name siteconfig`
</pre>


<p>
/tmp/nursery-skeleton-solr-and-security.tar.gz should now have everything
you need. You can now configure your FAI installation to use these by,
e.g.:
</p>



<pre class="src src-conf"><span style="color: #f0dfaf;">fai_presentation_ear</span>=/tmp/engine.ear
<span style="color: #f0dfaf;">fai_presentation_conf_archive</span>=/tmp/nursery-skeleton-solr-and-security.tar.gz
</pre>


<p>
Corresponding configuration options are available for the other server
profiles, see the table below.
</p>
<p>
The inclusion of the engine/solr directory makes it easy for users to
provide their own, optimised Solr configuration. In this context, also
note that a post install hook, set<sub>up</sub><sub>solr</sub>.postinst, is available.
</p>
</div>

</div>

<div id="outline-container-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Setting up virtual hosts</h3>
<div class="outline-text-3" id="text-6-2">

<p>Setting up virtual host definitions in the application server makes a
some things easier, such as ECE plugins which set cookies based on
information they get from the app server.
</p>
<p>
ece-install can set up the virtual hosts configuration for Tomcat
application servers if the profile is editorial, all presentation.
</p>
<p>
To use this feature, you must define one domain for each publication
in the following FAI parameter:
</p>


<pre class="src src-sh"><span style="color: #f0dfaf;">fai_publication_domain_mapping_list</span>=<span style="color: #ffa07a;">"</span>
<span style="color: #ffa07a;">firepub#fire.escenic.com</span>
<span style="color: #ffa07a;">ildpub#ild.escenic.com</span>
<span style="color: #ffa07a;">"</span>
</pre>


<p>
This will produce the following stanzas in server.xml:
</p>



<pre class="src src-nxml">&lt;<span style="color: #8cd0d3;">Host</span> <span style="color: #f0dfaf;">name</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">fire.escenic.com</span><span style="color: #ffa07a;">"</span> <span style="color: #f0dfaf;">appBase</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">webapps</span><span style="color: #ffa07a;">"</span> <span style="color: #f0dfaf;">autoDeploy</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span>&gt;
  &lt;<span style="color: #8cd0d3;">Context</span> <span style="color: #f0dfaf;">displayName</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">fire.escenic.com</span><span style="color: #ffa07a;">"</span>
           <span style="color: #f0dfaf;">docBase</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">firepub</span><span style="color: #ffa07a;">"</span>
           <span style="color: #f0dfaf;">path</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">/</span><span style="color: #ffa07a;">"</span>
  /&gt;
&lt;/<span style="color: #8cd0d3;">Host</span>&gt;
&lt;<span style="color: #8cd0d3;">Host</span> <span style="color: #f0dfaf;">name</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">ild.escenic.com</span><span style="color: #ffa07a;">"</span> <span style="color: #f0dfaf;">appBase</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">webapps</span><span style="color: #ffa07a;">"</span> <span style="color: #f0dfaf;">autoDeploy</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span>&gt;
  &lt;<span style="color: #8cd0d3;">Context</span> <span style="color: #f0dfaf;">displayName</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">ild.escenic.com</span><span style="color: #ffa07a;">"</span>
           <span style="color: #f0dfaf;">docBase</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">ildpub</span><span style="color: #ffa07a;">"</span>
           <span style="color: #f0dfaf;">path</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">/</span><span style="color: #ffa07a;">"</span>
  /&gt;
&lt;/<span style="color: #8cd0d3;">Host</span>&gt;
</pre>


<p>
You must of course make sure that these host names are resolvable to
the intended IPs on your system using /etc/hosts or a local DNS.
</p>
</div>

</div>

<div id="outline-container-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Overview of All FAI Parameters</h3>
<div class="outline-text-3" id="text-6-3">

<p>The ece-install script understands for the following settings in the
$HOME/ece-install.conf file of the root user:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Parameter</th><th scope="col" class="left">Default</th><th scope="col" class="left">Description</th></tr>
</thead>
<tbody>
<tr><td class="left">fai_all_install</td><td class="left">0</td><td class="left">Install all components on your server.</td></tr>
<tr><td class="left">fai_cache_backends</td><td class="left">${HOSTNAME}:8080</td><td class="left">Space separated, e.g. "app1:8080 app2:8080"</td></tr>
<tr><td class="left">fai_cache_install</td><td class="left">0</td><td class="left">Install cache server profile</td></tr>
<tr><td class="left">fai_db_host</td><td class="left">$HOSTNAME</td><td class="left">Useful for editor &amp; presentation profiles</td></tr>
<tr><td class="left">fai_db_drop_old_db_first</td><td class="left">0</td><td class="left">Warning: this will drop the old database before installing a new one</td></tr>
<tr><td class="left">fai_db_install</td><td class="left">0</td><td class="left">Install db profile</td></tr>
<tr><td class="left">fai_db_password</td><td class="left">read-the-source-luke</td><td class="left">Useful for DB installation profile</td></tr>
<tr><td class="left">fai_db_port</td><td class="left">3306</td><td class="left">Useful for editor &amp; presentation profiles</td></tr>
<tr><td class="left">fai_db_schema</td><td class="left">ece5db</td><td class="left">Useful for DB installation profile</td></tr>
<tr><td class="left">fai_db_user</td><td class="left">ece5user</td><td class="left">Useful for DB installation profile</td></tr>
<tr><td class="left">fai_editor_conf_archive</td><td class="left">""</td><td class="left">conf.tar.gz to use for Nursery &amp; JAAS configuration</td></tr>
<tr><td class="left">fai_editor_ear</td><td class="left">""</td><td class="left">EAR to use instead of the Escenic binaries</td></tr>
<tr><td class="left">fai_editor_install</td><td class="left">0</td><td class="left">Install the editorial profile</td></tr>
<tr><td class="left">fai_editor_name</td><td class="left">editor1</td><td class="left">Name of the editor instance</td></tr>
<tr><td class="left">fai_editor_port</td><td class="left">8080</td><td class="left">HTTP port of the editor instance</td></tr>
<tr><td class="left">fai_editor_shutdown</td><td class="left">8005</td><td class="left">Shutdown port of the editor instance</td></tr>
<tr><td class="left">fai_enabled</td><td class="left">0</td><td class="left">Whether or not to run ece-install in FAI mode</td></tr>
<tr><td class="left">fai_monitoring_server_install</td><td class="left">0</td><td class="left">Install the monitoring server profile.</td></tr>
<tr><td class="left">fai_monitoring_server_ip</td><td class="left">127.0.0.1</td><td class="left">The IP of the monitoring server.</td></tr>
<tr><td class="left">fai_presentation_conf_archive</td><td class="left">""</td><td class="left">conf.tar.gz to use for Nursery &amp; JAAS configuration</td></tr>
<tr><td class="left">fai_presentation_ear</td><td class="left">""</td><td class="left">EAR to use instead of the Escenic binaries</td></tr>
<tr><td class="left">fai_presentation_install</td><td class="left">0</td><td class="left">Install the presentation server profile</td></tr>
<tr><td class="left">fai_presentation_name</td><td class="left">web1</td><td class="left">Name of the presentation server instance</td></tr>
<tr><td class="left">fai_presentation_port</td><td class="left">8080</td><td class="left">HTTP port of the presentation server instance</td></tr>
<tr><td class="left">fai_presentation_shutdown</td><td class="left">8005</td><td class="left">Shutdown port of the presentation instance</td></tr>
<tr><td class="left">fai_public_host_name</td><td class="left">${HOSTNAME}:8080</td><td class="left">The public address for your website</td></tr>
<tr><td class="left">fai_publication_create</td><td class="left">0</td><td class="left">Create a new publication</td></tr>
<tr><td class="left">fai_publication_name</td><td class="left">mypub</td><td class="left">Name of the publication</td></tr>
<tr><td class="left">fai_publication_use_instance</td><td class="left">dev1</td><td class="left">Name of local instance to use for creation</td></tr>
<tr><td class="left">fai_publication_war</td><td class="left">"WF or ECE demo WAR"</td><td class="left">WAR to base the new publication on</td></tr>
<tr><td class="left">fai_publication_war_uri_list</td><td class="left">""</td><td class="left">Publication WARs used for setting up Assembly tool. Supported: http[s]://tmp.com/mypub.war, <a href="file:////tmp/mypub.war">///tmp/mypub.war</a> and /tmp/mypub.war.</td></tr>
<tr><td class="left">fai_publication_domain_mapping_list</td><td class="left">""</td><td class="left">Mapping between publication names and their corresponding domains on the form: one#one.com other#other.com</td></tr>
<tr><td class="left">fai_rmi_install</td><td class="left">0</td><td class="left">Install RMI hub profile</td></tr>
<tr><td class="left">fai_search_conf_archive</td><td class="left">""</td><td class="left">conf.tar.gz to use for Nursery &amp; JAAS configuration</td></tr>
<tr><td class="left">fai_search_ear</td><td class="left">""</td><td class="left">EAR to use instead of the Escenic binaries</td></tr>
<tr><td class="left">fai_search_for_editor</td><td class="left">0</td><td class="left">If 1 (true), will configure Solr for use with an editorial server, if not conf for presentation servers will be chosen.</td></tr>
<tr><td class="left">fai_search_indexer_ws_uri</td><td class="left"><a href="http://${HOSTNAME}:8080/indexer-webservice/index/">http://${HOSTNAME}:8080/indexer-webservice/index/</a></td><td class="left">URI of the indexer-webservice that the search instance shall use for knowing what to index.</td></tr>
<tr><td class="left">fai_search_install</td><td class="left">0</td><td class="left">Install the search server profile (Solr + indexer)</td></tr>
<tr><td class="left">fai_search_name</td><td class="left">search1</td><td class="left">Name of the search instance</td></tr>
<tr><td class="left">fai_search_port</td><td class="left">8080</td><td class="left">HTTP port of the search instance</td></tr>
<tr><td class="left">fai_search_shutdown</td><td class="left">8005</td><td class="left">Shutdown port of the search instance</td></tr>
<tr><td class="left">fai_wf_install</td><td class="left">0</td><td class="left">Install Widget Framework profile</td></tr>
</tbody>
</table>


<p>
As you've probably have guessed, 0 means "false" and 1 means "true" :-)
</p>
</div>

</div>

<div id="outline-container-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> Examples</h3>
<div class="outline-text-3" id="text-6-4">


</div>

<div id="outline-container-6-4-1" class="outline-4">
<h4 id="sec-6-4-1"><span class="section-number-4">6.4.1</span> Installing an Editorial Server &amp; Create a Publication</h4>
<div class="outline-text-4" id="text-6-4-1">

<p>To automatically install an editorial server and create a publication
called "jollygood", the minimal configuration in ece-install.conf
would be:
</p>



<pre class="src src-conf"><span style="color: #f0dfaf;">fai_enabled</span>=1
<span style="color: #f0dfaf;">fai_editor_install</span>=1
<span style="color: #f0dfaf;">fai_publication_create</span>=1
<span style="color: #f0dfaf;">fai_publication_name</span>=jollygood
</pre>


</div>

</div>

<div id="outline-container-6-4-2" class="outline-4">
<h4 id="sec-6-4-2"><span class="section-number-4">6.4.2</span> Installing Two Presentation Servers On a Single Host</h4>
<div class="outline-text-4" id="text-6-4-2">

<p>If you wish to only install two presentation servers called "web1" and
"web2" on your host, you will first run ece-install with:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">fai_enabled</span>=1
<span style="color: #f0dfaf;">fai_presentation_install</span>=1
<span style="color: #f0dfaf;">fai_presentation_name</span>=web1
</pre>


<p>
And then re-issue ece-install with the following configuration:
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">fai_enabled</span>=1
<span style="color: #f0dfaf;">fai_presentation_install</span>=1
<span style="color: #f0dfaf;">fai_presentation_name</span>=web2
<span style="color: #f0dfaf;">fai_presentation_port</span>=8081
<span style="color: #f0dfaf;">fai_presentation_shutdown</span>=8105
</pre>

<p>
Notice that this configuration has some extra options since the
previous run of ece-install could run with the default settings,
whereas the second one needs to override these.
</p>

</div>
</div>

</div>

<div id="outline-container-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> Verifying That the Script Is Running In FAI Mode</h3>
<div class="outline-text-3" id="text-6-5">

<p>When FAI is enabled, ece-install will report:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] Full Automatic Install (FAI) enabled.
[<span style="color: #98fb98;">ece-install</span>] All user input will be read from /root/ece-install.conf
</pre>


</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Running More Than One Installation Process</h2>
<div class="outline-text-2" id="text-7">

<p>If the script believes there's already an ece-intall process running,
it will abort:
</p>


<pre class="src src-conf">[<span style="color: #98fb98;">ece-install</span>] There<span style="color: #ffa07a;">'s already one ece-install process running. If you believe</span>
<span style="color: #ffa07a;">[ece-install] this is wrong, e.g. if a previous run of ece-install was aborted</span>
<span style="color: #ffa07a;">[ece-install] before it completed, you may delete /var/run/ece-install.pid and</span>
<span style="color: #ffa07a;">[ece-install] run ece-install again.</span>
</pre>


</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Re-running ece-install (and How To Speed It Up)</h2>
<div class="outline-text-2" id="text-8">

<p>Although the initial thought behind ece-install, is to run it on a
clean system to get up and running as soon as possible. However, you
may want to re-run ece-install on the same host, for instance to add
another instance of ECE, set up Widget Framework or create another
publication.
</p>
<p>
ece-install has a number of features which will try to minimise the
time it takes to run it on consecutive runs. If running on Debian
based systems, it will check if you already have installed
pre-requisite 3rd party libraries and only if any are missing will it
ask the package manager to fetch it.
</p>
<p>
Likewise, ece-install will see if the Escenic artifacts or application
server that you need are already present in the /tmp/ece-downloads
folder, and only download the missing ones (if any).
</p>
<p>
To get a list of the artifacts it'll pull from
<a href="http://technet.escenic.com">http://technet.escenic.com</a> and <a href="http://tomcat.apache.org">http://tomcat.apache.org</a> search for the
following variables:
</p><ul>
<li>technet_download_list
</li>
<li>wf_download_list
</li>
<li>tomcat_download
</li>
</ul>


<p>
Two other ways of speeding up the installation is (of course) to use
the backup/restore feature or install from a EAR and configuration
bundle, see the FAI section.
</p>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Using a Custom Configuration File for ece-install</h2>
<div class="outline-text-2" id="text-9">

<p>You can specify a different configuration by using the -f parameter: 
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">$</span> ece-install -f ece-install-presentation-server.conf
</pre>


</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Overview of File Paths Used by the ece-install script</h2>
<div class="outline-text-2" id="text-10">

<p>There are of course other paths involved when setting up your system,
but these should be the most interesting ones.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Path</th><th scope="col" class="left">Explanation</th></tr>
</thead>
<tbody>
<tr><td class="left">/etc/apt/sources.list.d/escenic.list</td><td class="left">3rd party APT repositories added by ece-install *)</td></tr>
<tr><td class="left">/etc/default/ece</td><td class="left">The configuration file for the ece init.d script</td></tr>
<tr><td class="left">/etc/escenic/ece-&lt;instance&gt;.conf</td><td class="left">Instance specific settings for /usr/bin/ece</td></tr>
<tr><td class="left">/etc/escenic/ece.conf</td><td class="left">Common ece.conf file for /usr/bin/ece</td></tr>
<tr><td class="left">/etc/escenic/engine/common</td><td class="left">Common Nursery configuration layer</td></tr>
<tr><td class="left">/etc/escenic/engine/common/security</td><td class="left">Common security configuration for all ECE instances.</td></tr>
<tr><td class="left">/etc/escenic/engine/common/trace.properties</td><td class="left">Log4j configuration, produces instance specific log files.</td></tr>
<tr><td class="left">/etc/escenic/engine/instance/&lt;instance&gt;</td><td class="left">Instance specific Nursery configuration</td></tr>
<tr><td class="left">/etc/escenic/solr</td><td class="left">ECE specific Solr configuration</td></tr>
<tr><td class="left">/etc/init.d/mysql[d]</td><td class="left">For starting and stopping MySQL/Percona</td></tr>
<tr><td class="left">/etc/init.d/varnish</td><td class="left">For starting and stopping Varnish</td></tr>
<tr><td class="left">/etc/intit.d/ece</td><td class="left">The init.d script managing <span style="text-decoration:underline;">all</span> the ECE instances on your host.</td></tr>
<tr><td class="left">/etc/varnish/default.vcl</td><td class="left">The Varnish configuration</td></tr>
<tr><td class="left">/opt/escenic</td><td class="left">All ECE components can be found here</td></tr>
<tr><td class="left">/opt/escenic/assemblytool</td><td class="left">The assembly tool</td></tr>
<tr><td class="left">/opt/escenic/assemblytool/plugins</td><td class="left">Contains symlinks to all plugins in /opt/escenic</td></tr>
<tr><td class="left">/opt/escenic/engine</td><td class="left">Symlink pointing to the current ECE</td></tr>
<tr><td class="left">/opt/tomcat</td><td class="left">Symlink pointing to the install Apache Tomcat (catalina_home)</td></tr>
<tr><td class="left">/opt/tomcat-&lt;instance&gt;</td><td class="left">Instance specific Tomcat files (catalina_base)</td></tr>
<tr><td class="left">/usr/bin/ece</td><td class="left">Script for operating all ECE instances + RMI hub and EAE</td></tr>
<tr><td class="left">/usr/sbin/drop-and-create-ecedb</td><td class="left">DB script used by the ece-install script</td></tr>
<tr><td class="left">/usr/sbin/ece-install</td><td class="left">The installation script described in this guide</td></tr>
<tr><td class="left">/var/log/escenic/&lt;type&gt;-&lt;instance&gt;.log</td><td class="left">The instance's log4j  log</td></tr>
<tr><td class="left">/var/log/escenic/&lt;type&gt;-&lt;instance&gt;.out</td><td class="left">The instance system out log</td></tr>
<tr><td class="left">/var/log/escenic/solr.&lt;date&gt;.log</td><td class="left">The Solr log (not in standard out!)</td></tr>
<tr><td class="left">/var/run/escenic/&lt;type&gt;-&lt;instance&gt;.pid</td><td class="left">The instance's  PID file</td></tr>
</tbody>
</table>


<p>
*) Applies only to Debian based systems.
</p>
</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Overriding the Escenic directories</h2>
<div class="outline-text-2" id="text-11">

<p>All of the Escenic specific directories may be overwritten in
ece-install.conf. Here's an example of changing all the paths possible
with the same suffix.
</p>



<pre class="src src-conf"><span style="color: #f0dfaf;">suffix</span>=escenic-parallel

<span style="color: #f0dfaf;">escenic_root_dir</span>=/opt/$suffix
<span style="color: #f0dfaf;">escenic_conf_dir</span>=/etc/$suffix
<span style="color: #f0dfaf;">escenic_log_dir</span>=/var/log/$suffix
<span style="color: #f0dfaf;">escenic_data_dir</span>=/var/lib/$suffix
<span style="color: #f0dfaf;">escenic_run_dir</span>=/var/run/$suffix
<span style="color: #f0dfaf;">escenic_backups_dir</span>=/var/backups/$suffix
<span style="color: #f0dfaf;">escenic_spool_dir</span>=/var/spool/$suffix
<span style="color: #f0dfaf;">escenic_cache_dir</span>=/var/cache/$suffix
<span style="color: #f0dfaf;">escenic_crash_dir</span>=/var/crash/$suffix
</pre>


<p>
Note, this is only needed if you are running two completely separate
environments on the same host. A use case is if you're setting up a
test environment and want to separate stacks of Escenic Content Engine
and plugins.
</p>
</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Extending ece-install by Writing Hooks</h2>
<div class="outline-text-2" id="text-12">

<p>ece-install  has a number of hooks on which you can hook on your own
scripts. The scripts are to reside in $HOME/ece-conf.d/ and have names
inspired by Debian's package scripts:
</p>



<pre class="src src-conf"><span style="color: #f0dfaf;">&lt;hook</span> name&gt;.&lt;phase&gt;
</pre>


<p>
e.g.:
</p>



<pre class="src src-conf"><span style="color: #f0dfaf;">install_analysis_server.preinst</span>
</pre>


<p>
Will be run before the body of the hook, just the corresponding
.postinst hook will be run after.
</p>

</div>

<div id="outline-container-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> Accessing ece-install variables</h3>
<div class="outline-text-3" id="text-12-1">

<p>Before running the hook, ece-install will make all its local variables
available in /var/run/escenic/ece-install.env, which can then be used
by the hook scripts.
</p>
</div>

</div>

<div id="outline-container-12-2" class="outline-3">
<h3 id="sec-12-2"><span class="section-number-3">12.2</span> Example hook</h3>
<div class="outline-text-3" id="text-12-2">

<p>Here is an example hook which will be run after the EAE is installed.
</p>



<pre class="src src-sh"><span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">Put this in is $HOME/ece-install.d/install_analysis_server.postinst</span>

<span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">read ece-install's current variables</span>
<span style="color: #b0c4de;">source</span> /var/run/escenic/ece-install.env

<span style="color: #7f9f7f; font-style: italic;"># </span><span style="color: #7f9f7f; font-style: italic;">do something useful</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Hello from $0, EAE is installed in ${tomcat_base}"</span> &gt; /tmp/hello.txt
</pre>


</div>

</div>

<div id="outline-container-12-3" class="outline-3">
<h3 id="sec-12-3"><span class="section-number-3">12.3</span> Available hooks</h3>
<div class="outline-text-3" id="text-12-3">

<p>Currently, the following hooks are available:
</p>



<pre class="src src-sh">install_analysis_server.preinst
install_analysis_server.postinst
set_up_solr.preinst
set_up_solr.postinst
</pre>


</div>
</div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> Assumptions</h2>
<div class="outline-text-2" id="text-13">


</div>

<div id="outline-container-13-1" class="outline-3">
<h3 id="sec-13-1"><span class="section-number-3">13.1</span> /etc/esecenic is shared</h3>
<div class="outline-text-3" id="text-13-1">

<p>It's assumed that the /etc/escenic directory is either on a shared
file system or rsync-ed among the hosts that are running the ECE
instances (the exception being database and cache servers).
</p>
</div>
</div>

</div>

<div id="outline-container-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> Uninstalling Everything That the ece-install Set Up</h2>
<div class="outline-text-2" id="text-14">

<p>WARNING: this is potentially dangerous as some of these components may
be used by other pieces of software you have running on your
host. However, this may be useful if you're installing a clean
environment and want to e.g. undo your previous install to install a
different profile.
</p>
<p>
Open the ece-install script and look for the "un_install_ece"
function, it has copy and pastable commands for undoing most/all
things set up by the script.
</p>

</div>

</div>

<div id="outline-container-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> Example Output FAI</h2>
<div class="outline-text-2" id="text-15">

<p>The ece-install will often be run in FAI mode where all the settings
are read from ~/ece-install.conf. Given the following entries in this
file: 
</p>


<pre class="src src-conf"><span style="color: #f0dfaf;">technet_user</span>=apples
<span style="color: #f0dfaf;">technet_password</span>=andoranges
<span style="color: #f0dfaf;">wf_user</span>=foo
<span style="color: #f0dfaf;">wf_password</span>=bar

<span style="color: #f0dfaf;">fai_enabled</span>=1
<span style="color: #f0dfaf;">fai_all_install</span>=1
</pre>


<p>
All the different components described in this guide are installed on
the host that runs the install script.
</p>
<p>
The following output is produced from ece-install:
</p>


<pre class="src src-text">[ece-install-0] Full Automatic Install (FAI) enabled.
[ece-install-0] All user input will be read from /root/ece-install.conf
[ece-install-0] I'm logging to /var/log/ece-install.log
[ece-install-1] Stopping conflicting processes ...
[ece-install-1] Installing 3rd party packages needed by ece-install ...
[ece-install-1] Setting up the ece UNIX scripts ...
[ece-install-2] Setting up the torstein user's UNIX environment ...
[ece-install-2] Installing a presentation server on quanah ...
[ece-install-2] Installing 3rd party packages needed by ECE ...
[ece-install-4] Setting up the basic Nursery configuration ...
[ece-install-4] Using the supplied Nursery &amp; JAAS configuration
[ece-install-4] from the bundle: /tmp/nursery-skeleton-and-security.tar.gz
[ece-install-4] Setting up the application server ...
[ece-install-5] Setting up proper log4j &amp; Java logging configuration ...
[ece-install-5] Setting correct permissions on ECE related directories ...
[ece-install-6] Assembling, deploying &amp; starting pres1 ...
[ece-install-7] I'm using the supplied EAR instead of running an assembly.
[ece-install-24] Adding the ece init.d script to the default run levels ...
[ece-install-24] Installing a Munin node on quanah ...
[ece-install-30] The installation is now complete! It took 0d 0h 0m 30s
[ece-install-30] - New ECE instance pres1 installed.
[ece-install-30] - Admin interface: http://quanah:9980/escenic-admin/
[ece-install-30] - View installed versions with: ece -i pres1 versions
[ece-install-30] - Type 'ece help' to see all the options of this script
[ece-install-30] - Read its guide: /usr/share/doc/escenic/ece-guide.txt
[ece-install-30] - /etc/default/ece lists all instances started at boot time
[ece-install-30] - A Munin node has been installed on quanah
[ece-install-30] - Install info: /usr/share/doc/escenic/ece-install-guide.txt
[ece-install-30] - Guide books: http://documentation.vizrt.com/ece-5.3.html
[ece-install-30] Enjoy your time with Escenic Content Engine!
[ece-install-30] -Vizrt Online

</pre>


</div>
</div>
</div>

<div id="postamble">
<hr/>
<p class="author">
  Author: Torstein Krause Johansen (<a href="mailto:tkj@vizrt.com">tkj@vizrt.com</a>)
  Date: 2012-02-07 19:40:37 CST
</p>
</div>
</body>
</html>
